// Generated by CoffeeScript 1.6.3
(function() {
  var Instagram, jp2a, moment, parseImages, renderImage, searchPublic, searchUser, _;

  _ = require('underscore');

  Instagram = require('instagram-node-lib');

  jp2a = require('jp2a');

  moment = require('moment');

  Instagram.set('client_id', 'b8b6e83a5194471d936670c484375a5d');

  Instagram.set('client_secret', '7a56b096833d41ff98f55369c837ef0d');

  parseImages = function(photos, pagination) {
    return _.each(photos, function(photo) {
      var author, dateStr, link, url;
      author = photo.user.username;
      url = photo.images.standard_resolution.url;
      dateStr = moment(photo.created_time).fromNow();
      link = photo.link;
      return renderImage(url, author, dateStr, link);
    });
  };

  renderImage = function(url, author, dateStr, link) {
    return jp2a([url, "--width=75", "--background=dark", "--color", "-b"], function(asciiArt) {
      console.log(asciiArt);
      console.log(link);
      console.log("By: " + author);
      return console.log(dateStr);
    });
  };

  searchPublic = function() {
    return Instagram.media.popular({
      complete: parseImages
    });
  };

  searchUser = function(user) {
    return Instagram.users.search({
      q: user,
      complete: function(data, pagination) {
        return Instagram.users.recent({
          user_id: data[0].id,
          complete: parseImages
        });
      }
    });
  };

  switch (process.argv[2]) {
    case "user":
      searchUser(process.argv[3]);
      break;
    default:
      searchPublic();
  }

}).call(this);
